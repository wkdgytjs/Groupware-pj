
# Police office + Grouware Project ğŸš”
> 2023.03.14 ~ 2023.04.06ê¹Œì§€ ì§„í–‰í•œ ê·¸ë£¹ì›¨ì–´ ê¸°ë³¸ ì—°ë™ ê¸°ëŠ¥ êµ¬í˜„ í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤.

## â• Description â•
<table>
  <tr>
    <td>
ì§€êµ¬ëŒ€ì—ì„œ ì“°ì¼ ë§Œí•œ ê´€ë¦¬ì í˜ì´ì§€ë¥¼ ê°€ì •í•˜ì—¬ ì œì‘í•œ ì‚¬ì´íŠ¸
    </td>
  </tr>
</table>

![MainIndex_2](https://user-images.githubusercontent.com/116870668/233940183-dcf7cc55-51af-4d64-98f3-b24696c19a9f.jpg)

<br>

## â°ê¸°íš ë°°ê²½ ë° í•´ê²°í•˜ê³ ì í•˜ëŠ” ë¬¸ì œ
<table>
  <tr>
    <td>
ê´€ë¦¬ì í˜ì´ì§€ëŠ” ì›í™œí•œ ì—…ë¬´ ì²˜ë¦¬ë¥¼ ìœ„í•œ í˜ì´ì§€ì´ê³ , ì¼ë°˜ì ì¸ ê²Œì‹œíŒê³¼ ë‹¬ë¦¬ ë”ìš± ë§ì€ ê¸°ëŠ¥ì„ ì œì–´í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
ë˜, ê²½ì°°ì˜ ì—…ë¬´ëŠ” ì‚¬ê±´ ì‚¬ê³ ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì—…ë¬´ê°€ ì§„í–‰ë˜ë¯€ë¡œ ì‚¬ê±´ ì‚¬ê³ ì— ì¤‘ì ì„ ë‘ê³  ì œì‘í•˜ì˜€ìŠµë‹ˆë‹¤.
    </td>
  </tr>
</table>

<br>


## â°ê°œë°œ ê´€ë ¨ ë¬¸ì„œ
<details>
<summary>ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§</summary>
  
![BusinessLogic](https://user-images.githubusercontent.com/116870668/234459286-41b37829-c274-42ec-a412-015c749e4fe1.png)

</details>
<details>
  
<summary>ERD</summary>
  
![DB design_2](https://user-images.githubusercontent.com/116870668/233940813-2613f5dc-58da-4786-81c3-f737ff3930f9.png)

</details>

<br>

## â°ì‚¬ìš©í•œ ê¸°ìˆ  ë° ë°°í¬ í™˜ê²½
<table>
  <tr>
    <th>OS</th>
    <th>Database</th>
    <th>IDE</th>
    <th>Framework</th>
    <th>Language</th>
  </tr>
  <tr>
    <td>Windows 10</td>
    <td>MySqL</td>
    <td>IntelliJ, Visual Studio Code</td>
    <td>Spring Boot</td>
    <td>Java, HTML, CSS, Javascript</td>
  </tr>
</table>

<br>

## â°Team (ë‹´ë‹¹í•œ ì—…ë¬´)
<details>
<summary> ê°•ì°½ì‹  </summary>

1. ê²°ì¬ë¬¸ì„œ CRUD
2. ê·¼íƒœ ê¸°ëŠ¥
3. naver-API
</details>
<details>
<summary> ê¹€ë“ì£¼ </summary>

1. ë¡œê·¸ì¸&Spring Security
2. ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°
</details>
<details>
<summary> ì´ì§€ì°½ </summary>

1. íšŒì›CRUD
2. ë¶€ì„œCRUD
3. FullCalendar-API
4. AWS EC2 ë°°í¬
</details>
<details>
<summary> ì¥íš¨ì„  </summary>

1. ê²Œì‹œíŒCRUD
2. ëŒ“ê¸€CRUD
3. ê° í˜ì´ì§€ design frame(Html,CSS) ì œì‘
</details>
<details>
<summary> í—ˆì¸ê²½ </summary>
  
1. ì‚¬ê±´CRU
2. left-Menubar ì œì‘
3. KakaoMap-API
</details>


***

## ğŸ“‹ ê²Œì‹œíŒ ê¸°ëŠ¥

<table>
  <tr>
    <td>
ê²Œì‹œíŒì€ ê³µì§€ê²Œì‹œíŒìœ¼ë¡œ ì§€ì •í•˜ì—¬ ê´€ë¦¬ì ê¶Œí•œì´ ìˆëŠ” ì‚¬ìš©ìë§Œ ë“±ë¡, ìˆ˜ì •, ì‚­ì œ ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ ì²˜ë¦¬ í•˜ì˜€ìŠµë‹ˆë‹¤.
    </td>
  </tr>
</table>

## â° ê²Œì‹œíŒ View ì˜ìƒ
![ê²Œì‹œíŒ](https://user-images.githubusercontent.com/116870668/234463107-6290e062-10c1-4d1e-87ac-c8c97b2c210e.gif)


### ë””ë ‰í† ë¦¬ êµ¬ì„± ë° ERD
<details>
<summary>ë””ë ‰í† ë¦¬ êµ¬ì„±</summary>
  
![board](https://user-images.githubusercontent.com/116870668/234480544-623e77f3-2864-4a72-a0ce-c9d6751801df.jpg)

</details>
<details>
  
<summary>ERD</summary>
  
![boardDB](https://user-images.githubusercontent.com/116870668/234481357-25114d5d-a33a-47fe-a064-0cdccb5cd90c.jpg)
  
> ì‚¬ìš©ì í•œëª…ì´ ì—¬ëŸ¬ ê²Œì‹œê¸€ì„ ì‘ì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ police_officer í…Œì´ë¸”ì€ boardí…Œì´ë¸”ê³¼ 1:N ê´€ê³„ ì„¤ì •
</details>

***

## âœï¸ ëŒ“ê¸€ ê¸°ëŠ¥

<table>
  <tr>
    <td>
ëŒ“ê¸€ì€ ê²Œì‹œê¸€ ìƒì„¸ í˜ì´ì§€ì—ì„œ ì‘ì„±ê°€ëŠ¥í•˜ë©° ë³¸ì¸ì˜ ëŒ“ê¸€ë§Œ ìˆ˜ì •, ì‚­ì œ ê¶Œí•œì„ ë¶€ì—¬í•˜ì—¬ ì²˜ë¦¬í•˜ì˜€ìŠµë‹ˆë‹¤.
    </td>
  </tr>
</table>

## â° ëŒ“ê¸€ View ì˜ìƒ
![ëŒ“ê¸€](https://user-images.githubusercontent.com/116870668/234489338-dde939bc-fa1a-4fbc-a3c2-d58770c2eb2a.gif)

<br>

### ë””ë ‰í† ë¦¬ êµ¬ì„± ë° ERD
<details>
<summary>ë””ë ‰í† ë¦¬ êµ¬ì„±</summary>
  
![reply](https://user-images.githubusercontent.com/116870668/234490549-484c08b3-5cfa-4261-9301-900ce0c00c18.jpg)
  
> ëŒ“ê¸€ì€ ê²Œì‹œê¸€ ìƒì„¸í˜ì´ì§€ì—ì„œ ì‘ì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ Viewë‹¨ íŒŒì¼ì„ ë³„ë„ë¡œ ìƒì„±í•˜ì§€ ì•Šê³ , boardDetail.htmlì— ì²˜ë¦¬í•´ì¤¬ìŠµë‹ˆë‹¤.
</details>
<details>
  
<summary>ERD</summary>
  
![replyDB](https://user-images.githubusercontent.com/116870668/234490541-27b061cd-7e77-4848-9e64-17e7b4cb91b0.jpg)
  
> ì‚¬ìš©ì í•œëª…ì´ ê²Œì‹œê¸€ í•œ ê³³ì— ëŒ“ê¸€ì„ ì—¬ëŸ¬ê°œ ì‘ì„±í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ board_reply í…Œì´ë¸”ì€ police_officer, board í…Œì´ë¸”ê³¼ ê°ê° N:1 ê´€ê³„ ì„¤ì •
</details>

## â° ê²Œì‹œê¸€, ëŒ“ê¸€ê¸°ëŠ¥ ê°œë°œ ê³¼ì •ì—ì„œì˜ ë¬¸ì œì 
> í•œ ì‚¬ìš©ìê°€ ê²Œì‹œê¸€ ìƒì„¸í˜ì´ì§€ì—ì„œ ìƒˆë¡œê³ ì¹¨ì´ë‚˜ ìˆ˜ì •ì„ í•˜ê±°ë‚˜ ëŒ“ê¸€ ì‘ì„±, ìˆ˜ì •, ì‚­ì œì‹œ ì¡°íšŒìˆ˜ê°€ ì˜¬ë¼ê°€ëŠ” ë¬¸ì œì ì´ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.
<details>
<summary>BoardController ê²Œì‹œê¸€ ìƒì„¸ëª©ë¡ code</summary>

```Java 
     // ê²Œì‹œê¸€ ìƒì„¸ ëª©ë¡
    @GetMapping("/boardDetail/{boardId}")
    public String boardDetail(@PathVariable("boardId") Long boardId, @AuthenticationPrincipal UserDetails user,
                              Model model) {

        Cookie[] cookies= request.getCookies();

        // ë¹„êµí•˜ê¸° ìœ„í•´ ìƒˆë¡œìš´ ì¿ í‚¤
        Cookie oldCookie=null;

        //cookiesê°€ nullì´ ì•„ë‹ˆë©´ cookieì˜ ì´ë¦„ì´ postViewì¸ì§€ í™•ì¸í•˜ê³ , ë§ìœ¼ë©´ oldCookieì— ì´ cookieë¥¼ ëŒ€ì…
        if(cookies!=null){
            for (Cookie cookie : cookies) {
                if (cookie.getName().equals("postView")) {
                    oldCookie = cookie;
                }
            }
        }

        // í•´ë‹¹ ê²Œì‹œíŒì˜ ë²ˆí˜¸ë¥¼ ë°›ì•„ ê²Œì‹œê¸€ ìƒì„¸í˜ì´ì§€ë¡œ ë„˜ê²¨ì¤Œ
        BoardDto boardDtos = boardService.boardDetailList(boardId);


        if (boardDtos != null) {

            model.addAttribute("boardDtos", boardDtos);

            //ë§Œì¼ oldCookieê°€ nullì´ ì•„ë‹ˆê³  oldCookieê°’ì— idê°’ì´ ì—†ì„ ë•Œ
            // (ìˆë‹¤ë©´ ì´ë¯¸ ì¡°íšŒí•œ ê²Œì‹œë¬¼ë¡œ ì¡°íšŒìˆ˜ê°€ ì˜¬ë¼ê°€ì§€ ì•ŠìŒ) ì¡°íšŒìˆ˜ ì˜¬ë¦¬ëŠ” ë©”ì†Œë“œ í˜¸ì¶œ
            if (oldCookie!=null) {

                if(!oldCookie.getValue().contains("["+ boardId.toString() +"]")){
                    oldCookie.setValue(oldCookie.getValue() + "_[" + boardId + "]");
                    response.addCookie(oldCookie);
                    //ì¿ ê¸°ë¥¼ ì¶”ê°€ ì‹œí‚¤ê³  ì¡°íšŒìˆ˜ ì¦ê°€ì‹œí‚´
                    boardService.upViews(boardId);
                }
            // oldCookieê°€ nullì¼ ê²½ìš° postViewë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì¿ í‚¤ë¥¼ ë§Œë“¤ê³  ì¡°íšŒìˆ˜ ì˜¬ë¦¬ëŠ” ë©”ì†Œë“œ í˜¸ì¶œ
            }else{
                Cookie newCookie = new Cookie("postView", "[" + boardId + "]");
                newCookie.setMaxAge(-1);
                response.addCookie(newCookie);

                boardService.upViews(boardId);


            // ëŒ“ê¸€ ì‘ì„±ì‹œ ë¡œê·¸ì¸ ëœ ì‚¬ìš©ì ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
            PoliceDto policeName = policeService.policeEmailSearch(user.getUsername());
            model.addAttribute("policeReplyName", policeName.getPoliceName());

            // ëŒ“ê¸€ ëª©ë¡
            List<ReplyDto> replyList = replyService.replyList(boardId);
            model.addAttribute("replyList", replyList);

            return "/board/boardDetail";
        } else {
            return null;
        }
    }  
```  
</details>
<details>
<summary>BoardService ì¡°íšŒìˆ˜ ì¦ê°€ code</summary> 
  
```Java
    // ê²Œì‹œê¸€ ì¡°íšŒì‹œ ì¡°íšŒìˆ˜ 1ì¦ê°€
    @Transactional
    public void upViews(Long boardId) {
        boardRepository.updateViews(boardId);
    }
```  
</details>
<details>
<summary>BoardRepository ì¡°íšŒìˆ˜ ì¦ê°€, ì¡°íšŒìˆ˜ ì¦ê°€ ë°©ì§€ Nativeì¿¼ë¦¬ë©”ì†Œë“œ code</summary> 
  
```Java
    @Modifying
    @Query(value = "update BoardEntity b set b.views=b.views+1 where b.boardId=:boardId")
    void updateViews(Long boardId);
```  
</details>
 
> ìœ„ ì½”ë“œë¥¼ ë³´ë©´ ì¡°íšŒìˆ˜ ì¦ê°€ë°©ì§€ë¥¼ ìœ„í•´ Cookieë¥¼ ì´ìš©í•˜ì˜€ì§€ë§Œ ì•„ì§ Cookieì‚¬ìš©ì— ë¯¸ìˆ™í•œ ë¶€ë¶„ì´ ìˆì–´ì„œ <br>
  í•œ ì‚¬ìš©ìê°€ í•˜ë‚˜ì˜ ê²Œì‹œê¸€ì„ ì¡°íšŒí–ˆì„ë•Œ ì¿ í‚¤ê°€ ìƒì„±ë˜ë©´ì„œ ë‚˜ë¨¸ì§€ ê²Œì‹œê¸€ì„ ì¡°íšŒí–ˆì„ë•ŒëŠ” ì¡°íšŒìˆ˜ì¦ê°€ê°€ ë˜ì§€ì•ŠëŠ” <br>
  ë¬¸ì œì ì´ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.
  
### â• í”„ë¡œì íŠ¸ ê¸°ê°„ë‚´ì— ìƒê°í•œ í•´ê²°ë°©ì•ˆ
 - boardDetail.htmlì—ì„œ keyì˜ valueë¥¼ trueë¡œ ì„¤ì •
  ```
     <a th:href="@{/replyDelete(boardId=${list.boardId},replyId=${list.replyId},key=true)}"
  ```
 - BoardControllerì˜ ë©”ì†Œë“œì˜ ì¸ìê°’ìœ¼ë¡œ @RequestParam() ì–´ë…¸í…Œì´ì…˜ì„ ë„£ì–´ keyì˜ ë°ì´í„°ê°’ë¥¼ ë°›ì•„ returnê°’ì— keyê°’ì„ ê°™ì´ ë³´ë‚´ì¤€ë‹¤.   
  ```Java
     @PostMapping("/replyWrite")
     public String replyWrite(@ModelAttribute ReplyDto replyDto, Model model,
                             @RequestParam(value = "key", required = false) String key) {

        // ëŒ“ê¸€ ì‘ì„±
        replyService.replyWrite(replyDto);
//      System.out.println("id >>>"+replyDto.getBoardId());

        // ëŒ“ê¸€ ëª©ë¡ -> ê²Œì‹œê¸€ id(ëŒ“ê¸€ì„ ë‹¨ ê²Œì‹œê¸€ì˜ id)ì˜ ë¦¬ìŠ¤íŠ¸ë§Œ get
        // ëŒ“ê¸€ì„ ì‘ì„±í•˜ê³  -> ê²Œì‹œê¸€ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸ -> DTO-> Entity -> ì €ì¥
        // ìƒì„¸ëª©ë¡í˜ì´ì§€ì— ê¸€ë²ˆí˜¸ì™€ ëŒ“ê¸€ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì§€ê³  ê°™ì´ ë³´ë‚¸ë‹¤.
        List<ReplyDto> replyList = replyService.replyList(replyDto.getBoardId());
        model.addAttribute("replyList", replyList);

        //ê²Œì‹œê¸€ id -> replyDto.getBoardId()/+ ì¡°íšŒìˆ˜ key
        return "redirect:/boardDetail/" + replyDto.getBoardId() + "/" + key;
    }
  ```  
 - BoardControllerì— @PathVariable ì–´ë…¸í…Œì´ì…˜ì„ ì´ìš©í•˜ì—¬ keyê°’ì„ ë°›ì•„ì™€, keyê°’ì— ë”°ë¼ ì¡°íšŒìˆ˜ ì¹´ìš´íŒ… ì¡°ê±´ì„ ë‹¤ë¥´ê²Œ ì¶”ê°€
  ```Java
     // ê²Œì‹œê¸€ ìƒì„¸ ëª©ë¡
    @GetMapping("/boardDetail/{boardId}/{key}")
    public String boardDetail(@PathVariable("boardId") Long boardId, @AuthenticationPrincipal UserDetails user,
                              @PathVariable(value = "key", required = false) String key,
                              Model model) {

        // keyê°’ì´ trueì´ê±°ë‚˜ nullì´ ì•„ë‹Œê²½ìš° ì¡°íšŒìˆ˜ ì¹´ìš´íŒ… X
        if (key.equals("true") && key != null) {
            boardService.noUpViews(boardId);

            // keyê°’ì´ trueê°€ ì•„ë‹ˆê±°ë‚˜ nullì¸ ê²½ìš° ì¡°íšŒìˆ˜ ì¹´ìš´íŒ… O
        } else {
            // ê²Œì‹œê¸€ ì¡°íšŒìˆ˜ 1ì¦ê°€
            boardService.upViews(boardId);
        }
    }
  ```        
<br> 
       
### â• ì¶”í›„ í•´ê²°ë°©ì•ˆ
<table>
  <tr>
    <td>ëŒ“ê¸€ ê¸°ëŠ¥ ì‹¤í–‰ ì‹œ ë‹¤ì‹œ ë¡œë”©í•˜ì§€ ì•Šê³  ìë°”ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì´ìš©í•´ì„œ ë¹„ë™ê¸°ì‹ìœ¼ë¡œ XMLì„ ì´ìš©í•˜ì—¬ ì„œë²„ì™€ í†µì‹ í•˜ëŠ” ë°©ì‹ì¸ ajaxë¥¼ ì‚¬ìš©í•´ ì¶”í›„ì— ì—…ë°ì´íŠ¸ë¥¼ í•´ ë³¼ ìƒê°ì…ë‹ˆë‹¤.
    </td>
  </tr>
</table>
  
  
***
  
ğŸ”—Project(team) github Link : [PoliceOfficeGroupware](https://github.com/ckdtls1124/PoliceOfficeGroupware/tree/master)

